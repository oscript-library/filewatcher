# FileWatcher

Библиотека для отслеживания изменений в файловой системе на языке OneScript.

## Описание

FileWatcher позволяет отслеживать изменения файлов в указанном каталоге, включая:
- Изменение содержимого файлов (через сравнение MD5 хешей)
- Добавление новых файлов
- Удаление файлов
- Изменение структуры каталогов

Библиотека поддерживает работу в синхронном и асинхронном (фоновом) режимах.

## Установка

```bash
opm install filewatcher
```

## Использование

### Базовый пример

```bsl
#Использовать filewatcher

// Обработчик изменений
Процедура ОбработатьИзменения(СтруктураИзменена, ИзмененныеФайлы, ТекущаяСтруктура)
    
    Если СтруктураИзменена Тогда
        Сообщить("Структура каталога изменена");
    КонецЕсли;
    
    Для Каждого Файл Из ИзмененныеФайлы Цикл
        Сообщить("Файл изменен: " + Файл.ПолноеИмя);
    КонецЦикла;

КонецПроцедуры

// Создаем экземпляр сканера
Сканер = Новый СканерИзмененийФайлов("/путь/к/каталогу", Истина, 1000);

// Настраиваем фильтры
Сканер.УстановитьМаску("*.os")
    .ДобавитьКаталогИсключения("/подкаталог");

// Запускаем мониторинг в фоновом режиме
Сканер.Запустить(Новый Действие(ЭтотОбъект, "ОбработатьИзменения"));
```

### Синхронный режим

```bsl
#Использовать filewatcher

Сканер = Новый СканерИзмененийФайлов("/путь/к/каталогу", Ложь, 2000);
Сканер.УстановитьМаску("*.txt");

// Запускает синхронное сканирование (блокирует выполнение)
Сканер.Запустить();

// Для остановки используйте в другом потоке:
// Сканер.ЗавершитьСканирование();
```

### Режим мониторинга производительности

```bsl
#Использовать filewatcher

Сканер = Новый СканерИзмененийФайлов("/путь/к/каталогу", Истина);
Сканер.РежимМониторингаСканирования(); // Включает вывод времени сканирования
Сканер.Запустить(Обработчик);
```

## API

### Конструктор

```bsl
Новый СканерИзмененийФайлов(ПутьККаталогу, ВыполнятьВФоне = Ложь, ИнтервалСканирования = 1000)
```

**Параметры:**
- `ПутьККаталогу` (Строка) - путь к каталогу для отслеживания
- `ВыполнятьВФоне` (Булево) - выполнять сканирование в фоновом задании (по умолчанию `Ложь`)
- `ИнтервалСканирования` (Число) - интервал между сканированиями в миллисекундах (по умолчанию 1000)

### Методы

#### `УстановитьМаску(Маска)` → `СканерИзмененийФайлов`

Устанавливает маску для фильтрации файлов.

**Параметры:**
- `Маска` (Строка) - маска файлов (например, "*.txt", "*.os")

**Пример:**
```bsl
Сканер.УстановитьМаску("*.os");
```

#### `ДобавитьКаталогИсключения(ПутьККаталогу)` → `СканерИзмененийФайлов`

Добавляет каталог в список исключений. Путь указывается относительно основного каталога.

**Параметры:**
- `ПутьККаталогу` (Строка) - относительный путь к каталогу (например, "/подкаталог")

**Пример:**
```bsl
Сканер.ДобавитьКаталогИсключения("/node_modules");
```

#### `РежимМониторингаСканирования()` → `СканерИзмененийФайлов`

Включает режим мониторинга производительности сканирования. При включенном режиме выводится время каждого сканирования в миллисекундах.

#### `Запустить(Обработчик)` → `Процедура`

Запускает сканирование каталога.

**Параметры:**
- `Обработчик` (Действие) - обработчик изменений (обязателен при `ВыполнятьВФоне = Истина`)

**Обработчик должен иметь следующую сигнатуру:**
```bsl
Процедура Обработчик(ИзмененаСтруктура, ИзмененныеФайлы, ТекущаяСтруктура)
    // ИзмененаСтруктура - Булево, Истина если была изменена структура каталогов
    // ИзмененныеФайлы - Массив из Файл, список измененных файлов
    // ТекущаяСтруктура - Массив из Файл, текущее состояние файлов
КонецПроцедуры
```

#### `ЗавершитьСканирование()` → `Процедура`

Устанавливает флаг завершения сканирования. Циклическое сканирование прервется при следующей итерации.

## Особенности

- **Быстрое сравнение**: Использует MD5 хеши для определения изменений файлов
- **Гибкая фильтрация**: Поддержка масок файлов и исключения каталогов
- **Асинхронность**: Работа в фоновом режиме без блокировки основного потока
- **Мониторинг производительности**: Встроенный режим для отслеживания времени сканирования

## Требования

- OneScript версии 2.0.0 или выше

## Лицензия

См. файл [LICENSE](LICENSE)

## Автор

Андрей Савадеров (Macegor)  
Email: savaderov.andrei@gmail.com

## Репозиторий

https://github.com/Macegor/filewatcher
